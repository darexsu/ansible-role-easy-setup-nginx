---
# install
#   ├── packages
#   ├── dependencies
#   └── repositories
# config
#   ├── nginx.conf
#   └── virtualhost.conf
#        ├── tcp\ip socket 
#        └── unix socket 

# Install
nginx_install:
  enabled: false
  packages: [nginx]
  dependencies:
    debian: [apt-transport-https, ca-certificates, curl, gnupg2, lsb-release, debian-archive-keyring] 
    redhat: []

# Install -> repository
nginx_repo:
  nginx:
    enabled: false
    deb: "deb http://nginx.org/packages/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} nginx"
    rpm: "http://nginx.org/packages/rhel/$releasever/$basearch/"
    gpg: "https://nginx.org/keys/nginx_signing.key"
  epel:
    enabled: false
    rpm: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm"
    gpg: "https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}"

# Config -> nginx.conf
nginx_conf:
  enabled: false
  file: "nginx.conf"
  from: "template"
  src: "nginx_conf.j2"
  vars:
    user: "www-data"
    worker_processes: "auto"
    error_log: "/var/log/nginx/error.log notice"
    pidfile: "/var/run/nginx.pid"
    worker_connections: "1024"
    multi_accept: "off"
    mime_file_path: "/etc/nginx/mime.types"
    access_log: "/var/log/nginx/access.log"
    sendfile: "off"
    tcp_nopush: "off"
    tcp_nodelay: "on"
    keepalive_timeout: "75s"
    keepalive_requests: "1000"

# Config -> {virtualhost}.conf
nginx_virtualhost: 
  enabled: false
  file: [default.conf]
  state: "present"
  src: "nginx_virtualhost.j2"
  vars:
    listen_port: "80"
    listen_ipv6: false
    server_name: "localhost"
    root: "/usr/share/nginx/html"
    index: "index.html index.htm index.php"
    error_page: ""
    access_log: false
    error_log: false
    php_fpm:
      tcp_ip_socket:
        listen: ""
      unix_socket:
        listen: ""