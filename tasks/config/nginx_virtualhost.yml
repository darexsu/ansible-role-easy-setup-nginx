---
- name: remove virtualhost.conf
  ansible.builtin.file:
    path: "/etc/nginx/conf.d/{{ nginx_virtualhost.file }}"
    state: absent
  when: nginx_virtualhost.state == "absent"
  notify: restart nginx

- name: copy config template to remote node
  ansible.builtin.template:
    src: "{{ nginx_virtualhost.src }}"
    dest: "/etc/nginx/conf.d/{{ item }}"
    owner: root
    group: root
    mode: 0644
  with_items: "{{ nginx_virtualhost.file }}"
  when: nginx_virtualhost.state == "present"
  notify: restart nginx